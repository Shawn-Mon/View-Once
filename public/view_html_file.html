<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="View once video player">
    <title>View Once Video</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body oncontextmenu="return false">
    <video autoplay controls controlsList="nodownload">
        <source src="" id="videoSource" type="video/mp4">
    </video>

    <div class="warning-overlay" id="warningOverlay">
        <div class="warning-message">
            ‚ö†Ô∏è This video can only be viewed once
        </div>
    </div>

    <div class="controls-hint" id="controlsHint">
        üí° Use video controls to play/pause
    </div>

    <script>
        // Dynamically set the video source
        const videoId = window.location.pathname.split("/").pop();
        document.getElementById("videoSource").src = `/stream/${videoId}`;

        // Hide warning overlay after 3s
        setTimeout(() => {
            const overlay = document.getElementById('warningOverlay');
            if (overlay) {
                overlay.style.transition = 'opacity 0.5s ease';
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 500);
            }
        }, 3000);

        // Hide controls hint after 5s
        setTimeout(() => {
            const hint = document.getElementById('controlsHint');
            if (hint) {
                hint.style.transition = 'opacity 0.5s ease';
                hint.style.opacity = '0';
                setTimeout(() => hint.remove(), 500);
            }
        }, 5000);

        // Prevent right-click
        document.addEventListener('contextmenu', (e) => e.preventDefault());

        // Prevent keyboard shortcuts for downloading
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'S')) e.preventDefault();
        });

        // Auto-play check
        window.addEventListener('load', () => {
            const video = document.querySelector('video');
            if (video) {
                video.play().catch(err => console.log('Auto-play prevented'));
            } else {
                document.body.innerHTML = `
                    <div class="error-container">
                        <div class="error-content">
                            <h1>‚õî Expired</h1>
                            <p>This video link has already been viewed or has expired.</p>
                            <a href="/" class="btn-home">‚Üê Back to Home</a>
                        </div>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
